<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://www.thanassis.space/asn1.html">
<meta name="author" content="Thanassis Tsiodras">
<meta name="author" content="Athanasios Tsiodras">
<meta name="author" content="ttsiod">
<meta name="author" content="ttsiodras">
<link type="text/css" rel="stylesheet" href="final-code-wavetheory-lightbox.css">
<link rel="stylesheet" type="text/css" href="asciinema-player.css">
<link type="application/rss+xml" rel="alternate" href="rss.xml" title="Coding and administration articles by ttsiodras">
<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript" src="scriptaculous.js?load=effects,builder"></script>
<script type="text/javascript" src="lightbox.js"></script>
<title>Useful old technologies: ASN.1</title>
</head>
<body>
    <div class="well" id="Page">
        <div id="Banner">Useful old technologies: ASN.1</div>
        <div id="MainContent">
            <a href="//www.reddit.com/r/programming/submit" onclick="window.location = window.location.protocol + '//www.reddit.com/r/programming/submit?url=' + encodeURIComponent(window.location); return false"> <img src="spreddit7.gif" alt="submit to programming reddit" border="0"> </a>
            <br>&nbsp;<br>
            <p><em>(July 2013)</em></p>

<p><a href="https://github.com/ttsiodras/asn1scc">
<img src="forkme_right_darkblue_121621.png" style="position: fixed; right: 0; top: 0;" alt="Fork me on GitHub">
</a></p>

<table border="1" frame="box" cellpadding="10" summary="for TL;DR people" bgcolor="#80DD80"> <tr><td><b>For the TL;DR crowd:</b>
If your programs are sending and receiving data structures, 
you are probably using high-level encapsulations - e.g. XML or JSON.
There are however far more optimal solutions in terms of memory, CPU
and network requirements ; ASN.1 is one of them.
<p>
Below you will find a short introduction into the why and how of serialization
with ASN.1, as well as hands-on sessions with an <a href="https://github.com/ttsiodras/asn1scc">open-source</a> ASN.1 compiler
implemented under the auspices of the European Space Agency.</td></tr></table>

<p>(<em>Do you already know about ASN.1 and/or XML/XSD/JSON? Then feel free to <a href="#using">skip</a>
this section. Otherwise keep reading</em>).</p>

<p>If you code for a living, you will inevitably end up in a position where two
processes are communicating over a link. The link-layer technology itself is
not important in this discussion: it can be sockets, or pipes, or whatever else
you fancy. What is important, is how you handle the problem of sending your
data "across the wire".</p>

<p>In the simplest of cases, you are writing the code at both ends - coding
both the server and the client, in the same language.</p>

<h2>The easy way - memory dump</h2>

<p>In that case, things appear easy enough - for example, assuming you write in C/C++ and
send data over sockets, you can just send a memory dump of the message itself:</p>

<div class='codegenWrapper'>
<pre><tt>
<span class="comment">// The message type</span>
<span class="keyword">struct</span><span class="normal"> </span><span class="classname">foo</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">long</span><span class="normal"> msgId</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">char</span><span class="normal"> myflag</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">float</span><span class="normal"> value</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> szDescription</span><span class="symbol">[</span><span class="number">10</span><span class="symbol">];</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> isReady</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="comment">// Sender</span>
<span class="type">void</span><span class="normal"> </span><span class="function">somefuncThatRunsInTheSendingProcess</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">// Populate message data</span>
<span class="normal">    </span><span class="symbol">...</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">foo</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">    b</span><span class="symbol">.</span><span class="normal">msgID </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">...</span>
<span class="normal">    b</span><span class="symbol">.</span><span class="normal">value </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">...</span>
<span class="normal">    </span><span class="symbol">...</span>
<span class="normal">    </span><span class="comment">// Send them across</span>
<span class="normal">    </span><span class="function">send</span><span class="symbol">(...,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">b</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">...);</span>
<span class="normal">    </span><span class="symbol">...</span>
<span class="cbracket">}</span>

<span class="comment">// Recipient</span>
<span class="type">void</span><span class="normal"> </span><span class="function">somefuncThatRunsOnTheReceivingProcess</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="symbol">...</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">foo</span><span class="normal"> b</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// Receive message data</span>
<span class="normal">    </span><span class="function">recv</span><span class="symbol">(...,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">b</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">...);</span>

<span class="normal">    </span><span class="comment">// Work with them</span>
<span class="normal">    </span><span class="symbol">...</span>
<span class="cbracket">}</span>
</tt></pre>
</div>

<p>(<em>how we would handle messages with pointers or references inside them is left as an exercise for the reader - and yes, ignore packet fragmentation for now</em>).</p>

<p>Looks easy and safe enough - block until the data of the structure are read, and work with them.</p>

<p>Until it becomes clear that...</p>

<ul>
<li>This code depends on all the fields of the structure being represented in memory
in exactly the same way, under both the receiver and sender platforms. If the
sender is a 64bit Intel PC, but the receiver is a 32bit ARM-based phone,
we have a problem: the long integer field 'msgId' is occupying more space (8 bytes)
on the sending machine, than the receiving phone expects (a 4 byte integer).</li>
<li>The two platforms may have different endianess  (little endian vs
big endian). Even if we used 'int' and checked that 'int' uses the same number
of bytes in both sender and recipient, we would still have to rearrange 
the incoming bytes of <code>msgId</code> to match the target CPU's endianess.</li>
<li>And that's not all ; even if we used 'int' and we rearranged
the bytes to address endianess differences, we would also have to make sure that 
the fields are aligned the same way by the two compilers in the two entities 
(sender / recipient).
A different structure alignment policy (e.g. how many pad bytes to use between
'myflag' and 'value'?) would wreck havoc in our actual data - and differences
of padding may also lead to a different <code>sizeof</code> - which would
mean overwriting the stack in the recipient...
That's when the real "fun" begins... Unpredictable behaviour, based on whether
our compilers emit code that detect overflows at run-time by checking buffer
canaries ('magic' signatures at both ends of each buffer), or, far worse, 
emit debugging information in the executable that "hides" the bug... because
we overwrite that information instead! - etc, etc...</li>
<li>Finally, imagine maintaining this code <em>across different platforms</em>. That is,
you don't have just Intel and ARM - but also PowerPC-based Macs and Itanium
based whatevers and made-in-China-phone-somethings.</li>
</ul>

<h2>Using higher-level languages</h2>

<p>Some of you may be thinking: <em>'Yeah, C/C++ causes this kind of
mayhem ; use a higher level language'</em>. It could be argued however that there
are a lot of markets where using low-level languages like C/C++ is mandatory. 
Embedded systems are a particularly good example - weak CPUs, little memory
available...</p>

<p>But OK, I'll follow along - let's use Python instead:</p>

<div class='codegenWrapper'>
<pre><tt><span class="symbol">+-----------------------+</span><span class="normal">   </span><span class="comment"># Sender</span>
<span class="symbol">|</span><span class="normal">   Data structure      </span><span class="symbol">|</span><span class="normal">   a </span><span class="symbol">=</span><span class="normal"> </span><span class="function">socket</span><span class="symbol">(...)</span>
<span class="symbol">|</span><span class="normal"> inside Sender process </span><span class="symbol">|</span><span class="normal">   </span><span class="symbol">...</span>
<span class="symbol">+-----------------------+</span><span class="normal">   a</span><span class="symbol">.</span><span class="function">send</span><span class="symbol">(</span><span class="normal"> pickle</span><span class="symbol">.</span><span class="function">dumps</span><span class="symbol">(</span><span class="normal">myvariable</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">           </span><span class="symbol">|</span>
<span class="normal">           </span><span class="symbol">|</span><span class="normal">      </span><span class="symbol">+------------+</span>
<span class="normal">           `</span><span class="symbol">-----&gt;|</span><span class="normal"> Serializer </span><span class="symbol">|</span>
<span class="normal">                  </span><span class="symbol">+------------+</span>
<span class="normal">                         </span><span class="symbol">|</span>
<span class="normal">                         </span><span class="symbol">|</span>
<span class="normal">                         </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">Link layer </span><span class="symbol">-</span><span class="normal"> sockets</span><span class="symbol">,</span><span class="normal"> etc</span><span class="symbol">)</span>
<span class="normal">                         </span><span class="symbol">|</span>
<span class="normal">                         </span><span class="symbol">|</span>
<span class="normal">                         </span><span class="symbol">|</span><span class="normal">  </span><span class="symbol">+--------------+</span>
<span class="normal">                         `</span><span class="symbol">-&gt;|</span><span class="normal"> Deserializer </span><span class="symbol">|</span>
<span class="normal">                            </span><span class="symbol">+--------------+</span>
<span class="normal">                                         </span><span class="symbol">|</span>
<span class="normal">                                         </span><span class="symbol">|</span>
<span class="normal">b </span><span class="symbol">=</span><span class="normal"> </span><span class="function">socket</span><span class="symbol">(...)</span><span class="normal">                          </span><span class="symbol">|</span><span class="normal">   </span><span class="symbol">+-------------------------+</span>
<span class="symbol">...</span><span class="normal">                                      </span><span class="symbol">|</span><span class="normal">   </span><span class="symbol">|</span><span class="normal">     Data structure      </span><span class="symbol">|</span>
<span class="normal">myvariable </span><span class="symbol">=</span><span class="normal"> pickle</span><span class="symbol">.</span><span class="function">loads</span><span class="symbol">(</span><span class="normal"> b</span><span class="symbol">.</span><span class="function">recv</span><span class="symbol">(...))</span><span class="normal">  `</span><span class="symbol">--&gt;|</span><span class="normal"> inside receiver process </span><span class="symbol">|</span>
<span class="normal">                                             </span><span class="symbol">+-------------------------+</span>
</tt></pre>
</div>

<p>(<em>if you are thinking about it, for now ignore the fact that the recv() call
may fetch only part of the serialized message because of packet fragmentation. For the
purposes of this example, assume that we get the exact packet of data sent by
the sender in that single recv() call</em>).</p>

<p>This is a definite improvement:  Python comes pre-loaded with a generic 
serializer. We no longer have to care about what exists inside
<code>myvariable</code>: Integers, float, strings, lists, dictionaries - they
will all safely migrate across different platforms, different CPUs' endianess,
different CPU word sizes, etc:</p>

<pre><code>$ ipython
Python 2.7.3 (default, Mar 5 2013, 01:19:40)
Type "copyright", "credits" or "license" for more information.

In [1]: import pickle

In [2]: a = {'msgId': 1, 'myflag': 'a', 'value': 255, 
        'szDescription': 'Hello', 'isReady': True}

In [3]: pickle.dumps(a)
Out[3]: "(dp0\nS'msgId'\np1\nI1\nsS'myflag'\np2\nS'a'\np3\nsS'
         szDescription'\np4\nS'Hello'\np5\nsS'value'\np6\nI255
         \nsS'isReady'\np7\nI01\ns."

In [4]: print pickle.loads(pickle.dumps(a))
{'msgId': 1, 'myflag': 'a', 'szDescription': 'Hello',
 'value': 255, 'isReady': True}
</code></pre>

<p>We have no clue about how <code>pickle.dumps</code> encodes things, <em>but we don't care</em> ; as
long as they decode fine on the other end, why should we?</p>

<p>Great.</p>

<p>But does this mean that we will code all our software in Python from now on?</p>

<h2>Unfortunately, not always an option...</h2>

<p>I wish :&#x2011;)</p>

<p>As a developer, you will <em>inevitably</em> come to the position where you need to
work with other people, that don't care for your preferred language.</p>

<p>Think about it...</p>

<p>How can you send your data structures across,
to a program that is written <em>in a completely different language</em>?</p>

<ul>
<li><p>Well, if you are <em>really</em> patient and have lots of resources to waste,
you can design your own handmade encoding, and manually create
encoders and decoders in all the languages you use - taking great pains 
to make sure the data are transferred correctly in all possible
combinations of CPUs, platforms, etc.</p></li>
<li><p>Or you could use XML, JSON, or similar generic message representations. But that option too, comes at a price: </p>

<ul>
<li>you will be using generic parsers at run-time - causing memory and CPU overhead</li>
<li>your messages will be encoded in verbose representations - causing network overhead</li>
</ul></li>
<li><p>Or...</p></li>
</ul>

<p><a name="using"></a></p>

<h2>Abstract Syntax Notation One (ASN.1)</h2>

<p>You saw above that Python did a marvelous job of hiding the message encoding
details by automating the handling of different types in the <code>pickle</code>
module. Wouldn't it be fabulous if we had this kind of machinery across <em>different</em> languages?</p>

<p>Guess what - we do. Since the 1980's, in fact - it's called <a href="http://en.wikipedia.org/wiki/Abstract_Syntax_Notation_One">ASN.1</a>.</p>

<p>The <a href="http://xkcd.com/927">idea behind it</a> is very simple: specify your exchanged message data types in a data description language:</p>

<div class='codegenWrapper'>
<pre><tt><span class="normal">Message </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">SEQUENCE</span><span class="normal"> {</span>
<span class="normal">    msgId </span><span class="type">INTEGER</span><span class="symbol">,</span>
<span class="normal">    myflag </span><span class="type">INTEGER</span><span class="symbol">,</span>
<span class="normal">    value </span><span class="type">REAL</span><span class="symbol">,</span>
<span class="normal">    szDescription </span><span class="type">OCTET STRING</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE</span><span class="symbol">(</span><span class="number">10</span><span class="symbol">)),</span>
<span class="normal">    isReady </span><span class="type">BOOLEAN</span>
<span class="normal">}</span>
</tt></pre>
</div>

<p>The language uses simple constructs to describe data types <a href="#nevermindthem">[1]</a>. SEQUENCEs are what you would call <code>struct</code>s or <code>record</code>s in other languages - and as you can see, they contain descriptions of their fields. The usual basic types are there: BOOLEAN, INTEGER, REAL, ENUMERATED, OCTET STRING, etc - and SEQUENCEs can contain not only them, but also other SEQUENCEs, or arrays (SEQUENCE OFs).</p>

<p>Once we have written our ASN.1 grammar, we then feed it to an <strong>ASN.1 compiler - a tool that reads the specification, and emits, in our desired target language(s), (a) the language-specific type declarations, and (b) two functions per type: an encoder and a decoder, that encode and decode type instances to/from bitstreams.</strong></p>

<h3>A hands-on example</h3>

<p>First, download the <a href="http://download.tuxfamily.org/taste/DMT/DMT-latest.tgz">Data Modelling Tools</a> ; a tool suite that contains a free, <a href="https://github.com/ttsiodras/asn1scc">open-source</a> ASN.1 compiler
developed under the supervision of the European Space Agency.</p>

<p>Installing it is easy:</p>

<pre><code>$ wget http://download.tuxfamily.org/taste/DMT/DMT-latest.tgz
...
$ tar zxvf DMT-latest.tgz
...
$ cd DMT-r*
$ ./install.sh

Install in what folder [Default: /opt/DMT] /home/ttsiod/DMT

Installation completed successfully.
</code></pre>

<p>The install script will tell you if you are missing any dependencies,
and suggest installing them. It will also indicate what to do next:</p>

<pre><code>Now please setup your shell startup scripts to source...

    source /home/ttsiod/DMT/DMT_vars.csh

...if you use C-shells, or

    source /home/ttsiod/DMT/DMT_vars.sh

...otherwise (bash, etc). You can of course also source these right 
now in your current shell, and then run any of the DMT tools ;
they will exist in the PATH (asn1.exe, asn2dataModel, aadl2glueC)

To learn what you can do with the DMT tools, start by reading
'/home/ttsiod/DMT/README' - this will point you to additional docs.
</code></pre>

<p>I am using bash, so I follow the second path:</p>

<pre><code>$ echo '. /home/ttsiod/DMT/DMT_vars.sh' &gt;&gt; ~/.bashrc
$ source /home/ttsiod/DMT/DMT_vars.sh

$ which asn1.exe
/home/ttsiod/DMT/tools/asn1scc.3/asn1.exe

$ asn1.exe
No input files
...
Current Version is: 3.0.976 
Usage:

asn1  &lt;OPTIONS&gt; file1, file2, ..., fileN 

Where OPTIONS are:
...
</code></pre>

<p>The ASN.1 compiler is up and running <a href="#fsharp">[2]</a>. </p>

<p>Here's what the ASN.1 compiler creates when it is invoked on our simple ASN.1 grammar:</p>

<pre><code>$ cat sample.asn
</code></pre>

<div class='codegenWrapper'>
<pre><tt><span class="normal">MY</span><span class="symbol">-</span><span class="normal">MODULE </span><span class="keyword">DEFINITIONS</span><span class="normal"> </span><span class="keyword">AUTOMATIC</span><span class="normal"> </span><span class="keyword">TAGS</span><span class="normal"> </span><span class="symbol">::=</span><span class="normal"> </span><span class="keyword">BEGIN</span>

<span class="normal">Message </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">SEQUENCE</span><span class="normal"> {</span>
<span class="normal">    msgId </span><span class="type">INTEGER</span><span class="symbol">,</span>
<span class="normal">    myflag </span><span class="type">INTEGER</span><span class="symbol">,</span>
<span class="normal">    value </span><span class="type">REAL</span><span class="symbol">,</span>
<span class="normal">    szDescription </span><span class="type">OCTET STRING</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE</span><span class="symbol">(</span><span class="number">10</span><span class="symbol">)),</span>
<span class="normal">    isReady </span><span class="type">BOOLEAN</span>
<span class="normal">}</span>

<span class="keyword">END</span>
</tt></pre>
</div>

<pre><code>$ asn1.exe -c -uPER sample.asn
$ ls -l
total 220
-rw-r--r-- 1 ttsiod ttsiod 22131 Jun 18 17:36 acn.c
-rw-r--r-- 1 ttsiod ttsiod 19479 Jun 18 17:36 asn1crt.c
-rw-r--r-- 1 ttsiod ttsiod 16467 Jun 18 17:36 asn1crt.h
-rw-r--r-- 1 ttsiod ttsiod 12757 Jun 18 17:36 ber.c
-rw-r--r-- 1 ttsiod ttsiod 48772 Jun 18 17:36 real.c
-rw-r--r-- 1 ttsiod ttsiod   254 Jun 18 17:36 sample.asn
-rw-r--r-- 1 ttsiod ttsiod 51789 Jun 18 17:36 sample.c
-rw-r--r-- 1 ttsiod ttsiod  4098 Jun 18 17:36 sample.h
-rw-r--r-- 1 ttsiod ttsiod 24443 Jun 18 17:36 xer.c

$ gcc -c -I . *.c
$ echo $?
0
</code></pre>

<p>So, a number of .c and .h files were generated, which GCC then successfully compiled.</p>

<p>The 'gateway' - the only file you need to care about - is <code>sample.h</code>. Remember in our description above, we said:</p>

<p><em>... an ASN.1 compiler reads this specification, and emits, in our desired target languages, (a) the language-specific type declaration, and (b) two functions per type: an encoder and a decoder, that encode and decode type instances to/from bitstreams.</em></p>

<p>This is the type declaration that ASN1SCC generated for our message:</p>

<div class='codegenWrapper'>
<pre><tt><span class="normal">$ </span><span class="usertype">cat</span><span class="normal"> sample</span><span class="symbol">.</span><span class="normal">h</span>
<span class="symbol">...</span>
<span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">struct</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">asn1SccSint</span><span class="normal"> msgId</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">asn1SccSint</span><span class="normal"> myflag</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">double</span><span class="normal"> value</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">Message_szDescription</span><span class="normal"> szDescription</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">flag</span><span class="normal"> isReady</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="normal"> Message</span><span class="symbol">;</span>
<span class="symbol">...</span>
</tt></pre>
</div>

<p><code>asn1SccSint</code> is a typedef inside the Run-time library (asn1crt.h) - and is defined as a 64bit <code>int</code>. Similarly, <code>flag</code> is typedef-ed to <code>bool</code>. So, the ASN.1 compiler generated a <strong>semantically-equivalent transformation</strong> of the ASN.1 grammar, into our target language's declaration of the corresponding types.</p>

<p>We also said the ASN.1 compiler generates two functions - an encoder, and a decoder. And indeed: </p>

<div class='codegenWrapper'>
<pre><tt><span class="normal">$ </span><span class="usertype">cat</span><span class="normal"> sample</span><span class="symbol">.</span><span class="normal">h</span>
<span class="symbol">...</span>
<span class="usertype">flag</span><span class="normal"> </span><span class="function">Message_Encode</span><span class="symbol">(</span>
<span class="normal">    </span><span class="keyword">const</span><span class="normal"> Message</span><span class="symbol">*</span><span class="normal"> val</span><span class="symbol">,</span><span class="normal"> ByteStream</span><span class="symbol">*</span><span class="normal"> pByteStrm</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="symbol">*</span><span class="normal"> pErrCode</span><span class="symbol">,</span><span class="normal"> </span>
<span class="normal">    </span><span class="usertype">flag</span><span class="normal"> bCheckConstraints</span><span class="symbol">);</span>
<span class="usertype">flag</span><span class="normal"> </span><span class="function">Message_Decode</span><span class="symbol">(</span>
<span class="normal">    Message</span><span class="symbol">*</span><span class="normal"> pVal</span><span class="symbol">,</span><span class="normal"> ByteStream</span><span class="symbol">*</span><span class="normal"> pByteStrm</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="symbol">*</span><span class="normal"> pErrCode</span><span class="symbol">);</span>
</tt></pre>
</div>

<ul>
<li>the Encode function takes a pointer to an instance of the type, and a pointer to a ByteStream ; and will encode the fields of the message into a ByteStream (a simple data structure defined inside the Run-time Library, that can store a number of bytes <a href="#ByteStream">[3]</a>).</li>
<li>the Decode function does the reverse work: it takes a pointer to an instance of the type (where it will decode into), and a pointer to a ByteStream.  It will decode the fields of the message from the encoded representation inside pByteStrm (<em>which, remember, you don't care about ; think of the magic string that Python generated when we called the <code>pickle.dumps</code> function</em>).</li>
<li>The Encode function also takes a pointer to an integer, where it will store an error code (if an error occurs). What kinds of errors can occur, you ask? In the case of our simple ASN.1 grammar, there is indeed no way to fail - but if we change it to this...</li>
</ul>

<div class='codegenWrapper'>
<pre><tt><span class="normal">Message </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">SEQUENCE</span><span class="normal"> {</span>
<span class="normal">    msgId </span><span class="type">INTEGER</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">..</span><span class="number">10000</span><span class="symbol">),</span>
<span class="normal">    myflag </span><span class="type">INTEGER</span><span class="symbol">,</span>
<span class="normal">    value </span><span class="type">REAL</span><span class="symbol">,</span>
<span class="normal">    szDescription </span><span class="type">OCTET STRING</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE</span><span class="symbol">(</span><span class="number">10</span><span class="symbol">)),</span>
<span class="normal">    isReady </span><span class="type">BOOLEAN</span>
<span class="normal">}</span>
</tt></pre>
</div>

<p>...then the ASN.1 compiler generates an error code definition:</p>

<div class='codegenWrapper'>
<pre><tt><span class="preproc">#ifndef</span><span class="normal"> ERR_Message_msgId </span>
<span class="preproc">#define</span><span class="normal"> ERR_Message_msgId     </span><span class="number">1003</span><span class="normal">  </span><span class="comment">/*(0 .. 10000)*/</span>
<span class="preproc">#endif</span>
</tt></pre>
</div>

<p>...and it is this error code that will be stored inside <code>pErrCode</code>, if we <em>violate the constraint</em>. That is, if we call Encode with an invalid value inside the <code>.msgId</code> field of the <code>val</code> argument, the encoder will report this error code.</p>

<p>In case you missed it, or it wasn't clear enough:</p>

<p>In ASN.1, we can specify not only the field types, but also limits on their values - and have them automatically checked!</p>

<p>And that's the main idea. You can use this generated C code in your projects - it will just <em>work</em>. There are no external dependencies, no libraries to speak of, the code is there, open, for you to use as you please. Note that the encoders will <em>properly</em> handle all manner of potential mischief: endianess of the platform you compile it on, word sizes, etc. You can be sure that by using ASN.1, your encoded messages (that is, the representations inside the ByteStreams) can be sent to whatever platform you fancy, and they will decode fine, into the receiving platform's variables.</p>

<p>(<em>Note: ASN1SCC is made <a href="http://web1.see.asso.fr/erts2012/Site/0P2RUC89/7C-4.pdf">specifically for embedded, safety-critical systems</a>, so it only addresses ASN.1 grammars containing bounded (in size) messages. ASN.1 itself has no such limitation - e.g. you can model open-ended SEQUENCEOFs with it</em>).</p>

<h2>What if I have more than one message? Complex ones?</h2>

<p>Actually, that's what ASN.1 was <em>built for</em> : to allow easy specification of all the messages that will be exchanged between your apps, regardless of their complexity. Here's a more advanced example, showing ENUMERATED types, nesting inside SEQUENCEs, etc:</p>

<div class='codegenWrapper'>
<pre><tt><span class="normal">MyInt </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">INTEGER</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="normal"> </span><span class="symbol">..</span><span class="normal"> </span><span class="number">20</span><span class="symbol">)</span>

<span class="normal">TypeEnumerated </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">ENUMERATED</span><span class="normal"> {</span>
<span class="normal">    red</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">    green</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">),</span>
<span class="normal">    blue</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">}</span>

<span class="normal">My2ndEnumerated </span><span class="symbol">::=</span><span class="normal"> TypeEnumerated</span>

<span class="normal">AComplexMessage </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">SEQUENCE</span><span class="normal"> {</span>
<span class="normal">    intVal          </span><span class="type">INTEGER</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">..</span><span class="number">10</span><span class="symbol">),</span>
<span class="normal">    int2Val         </span><span class="type">INTEGER</span><span class="symbol">(-</span><span class="number">10</span><span class="symbol">..</span><span class="number">10</span><span class="symbol">),</span>
<span class="normal">    int3Val         MyInt </span><span class="symbol">(</span><span class="number">10</span><span class="symbol">..</span><span class="number">12</span><span class="symbol">),</span>
<span class="normal">    intArray        </span><span class="type">SEQUENCE</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE </span><span class="symbol">(</span><span class="number">10</span><span class="symbol">))</span><span class="normal"> </span><span class="type">OF</span><span class="normal"> </span><span class="type">INTEGER</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">..</span><span class="number">3</span><span class="symbol">),</span>
<span class="normal">    realArray       </span><span class="type">SEQUENCE</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE </span><span class="symbol">(</span><span class="number">15</span><span class="symbol">))</span><span class="normal"> </span><span class="type">OF</span><span class="normal"> </span><span class="type">REAL</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0.1</span><span class="normal"> </span><span class="symbol">..</span><span class="normal"> </span><span class="number">3.14</span><span class="symbol">),</span>
<span class="normal">    octStrArray     </span><span class="type">SEQUENCE</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE </span><span class="symbol">(</span><span class="number">20</span><span class="symbol">))</span><span class="normal"> </span><span class="type">OF</span><span class="normal"> </span><span class="type">OCTET STRING</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">..</span><span class="number">10</span><span class="symbol">)),</span>
<span class="normal">    enumArray       </span><span class="type">SEQUENCE</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE </span><span class="symbol">(</span><span class="number">12</span><span class="symbol">))</span><span class="normal"> </span><span class="type">OF</span><span class="normal"> TypeEnumerated</span><span class="symbol">,</span>
<span class="normal">    enumValue       TypeEnumerated</span><span class="symbol">,</span>
<span class="normal">    enumValue2      </span><span class="type">ENUMERATED</span><span class="normal"> {</span>
<span class="normal">        truism</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">        falsism</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">    }</span><span class="symbol">,</span>
<span class="normal">    label           </span><span class="type">OCTET STRING</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE</span><span class="symbol">(</span><span class="number">10</span><span class="symbol">..</span><span class="number">40</span><span class="symbol">)),</span>
<span class="normal">    bAlpha          T</span><span class="symbol">-</span><span class="normal">BOOL</span><span class="symbol">,</span>
<span class="normal">    bBeta           </span><span class="type">BOOLEAN</span><span class="symbol">,</span>
<span class="normal">    sString         T</span><span class="symbol">-</span><span class="normal">STRING</span><span class="symbol">,</span>
<span class="normal">    </span><span class="symbol">...</span>
<span class="normal">}</span>
</tt></pre>
</div>

<p>The language is fairly simple, so you should be able to figure out what is going on. If not, you can study <a href="http://www.oss.com/asn1/resources/books-whitepapers-pubs/asn1-books.html#dubuisson">Olivier Dubuisson's freely available book</a> for an extensive treatment of ASN.1 - all the way up to advanced features.</p>

<p>Processing this grammar with any ASN.1 compiler (including ASN1SCC), you would be all set to use the ready-made message definitions for <code>AComplexMessage</code>, <code>TypeEnumerated</code>, ... and their corresponding encoders/decoders.</p>

<p>In plain words - <strong>the complexity and the number of messages don't matter</strong> when you use ASN.1.</p>

<h2>And this works for any language?</h2>

<p>Yes, there are ASN.1 compilers for almost any language you can think of. ASN1SCC in particular, has been developed under the supervision of the European Space Agency, and it targets C and Ada, with specific emphasis on embedded, safety-critical systems - for which it does some <a href="http://web1.see.asso.fr/erts2012/Site/0P2RUC89/7C-4.pdf">pretty amazing things</a>:</p>

<ul>
<li>it never uses any heap - no <code>malloc</code> is ever called; what would you do in space when your satellite runs out of heap? Blue screen? :&#x2011;)</li>
<li>it can automatically generate test cases (i.e. instances of the ASN.1 grammar's messages), that will exercise the encoders and the decoders at full 100% coverage (very important for safety critical systems)</li>
<li>if you use SPARK/Ada, it emits code contracts, that a static compile-time verifier can prove ; making it absolutely certain that no such errors can occur at runtime.</li>
<li>it generates human-readable code (as opposed to other ASN.1 compilers that emit very cryptic code - chains-of-function-pointers-in-global-structures...)</li>
<li>...and has various other interesting features.</li>
</ul>

<p>Suffice to say, if you are involved with embedded development, it's worth taking a look.</p>

<h2>Isn't XML/JSON better than this?</h2>

<p>Well, it depends on your definition of 'better'.</p>

<p>If you value optimal encoding/decoding performance, minimal encoded message size, guarantees of code safety, and minimal power requirements for encoding/decoding messages, then no, XML is most definitely NOT better. That's why your mobile phone has used ASN.1 encoding while you were reading this article. I am not kidding - almost <em>every single signalling message</em> that your phone sends to the local cell tower, is encoded via ASN.1!</p>

<p>If on the other hand...</p>

<ul>
<li>you don't care for performance or safety requirements, and XML parsing is cheap in your problem domain</li>
<li>you have lots of memory to waste and don't care about optimal message representations</li>
<li>you want to easily peek into the encoded streams and figure out things during debugging (but read below for XER, and also note that <a href="http://wiki.wireshark.org/Asn2wrs">wireshark has an ASN.1 inspector</a>)</li>
<li>you have other development dependencies, like extensive use of XPath...</li>
</ul>

<p>... then yes, XML/JSON may be a better match for you. </p>

<h2>What about CORBA? Or other middleware tech?</h2>

<p>Let me repeat: If you care about <em>optimal</em> encoding/decoding performance, <em>optimal</em> memory use, ... </p>

<p>Remember, when we are speaking about ASN.1, we are looking at technology that was built by the Ancients. Being optimal wasn't a choice, back then - it was <em>mandatory</em>. You didn't have resources to waste. When you use ASN.1, you simply automate the parts of message marshalling that <em>can be automated, without losing any performance or wasting any memory</em>.</p>

<p>Do a low-level comparison of ASN.1 with any other technology that involves marshalling, and I guarantee you will be paying something at runtime: memory use, performance, or both.</p>

<h2>How does ASN.1 represent the messages on the wire?</h2>

<p>ASN.1 comes with a set of predefined rules, that specify how encoding is done. You choose one when you invoke the ASN.1 compiler on your ASN.1 grammar - ASN1SCC, for example, currently supports four:</p>

<ul>
<li>Basic Encoding Rules (BER), is the most basic one: it emits a stream comprised of <b>T</b>ags, <b>L</b>engths, and <b>V</b>alues per each field (TLV-encoding). As such, it is a rather verbose encoding, but it is extremely easy to decode - no CPU overhead whatsoever. </li>
<li>Packed Encoding Rules (PER), and in particular, Unaligned PER (UPER), is the most "space-optimal" encoding, packing field information as tightly as possible. In PER, for example, when you specify that an INTEGER field has a constraint of (0..15), only 4 bits will be used in the encoded stream to represent it. </li>
<li>XML Encoding Rules (XER), is using an XML representation for the data - so you can use ASN.1 and enjoy type-safe declarations inside your languages, but have an easily inspectable format (on the wire).</li>
<li>Finally, ACN is a custom, advanced encoding that allows you to control the details of the encoding yourself - but that's too advanced for this too-big-already-blog post.</li>
</ul>

<p>Note that choosing encoding has <em>zero</em> impact on your type declarations - you can switch between encodings without changing anything in your user code, except the name of the encoding/decoding function you call: e.g. instead of the default encoding (UPER), where you call <code>Message_Decode</code>, you'd call <code>Message_BER_Decode</code> - etc.</p>

<h2>OK, I see it now - this can be useful</h2>

<p>ASN.1 basically allows your programs to communicate with implementations coded in other languages, by establishing common ground - through a simple <a href="#nevermindthem">[1]</a> data definition language. If you use it, <em>arbitrarily complex messages</em> are handled easily: think of arrays containing unions containing structs - or, in ASN.1 parlance, SEQUENCE OFs containing CHOICEs containing SEQUENCEs). You don't have to ever implement any serializers/deserializers of the messages, and provided you use a compiler like ASN1SCC, you also get guarantees of correctness, type safety and performance - for free.</p>

<h2>And then, you realize you can do some magic...</h2>

<p>Equally important - and this is a matter for another blog post, but consider this a teaser - by using ASN.1 to define your messages, you can then automatically create many things <em>that are depending on the message definitions</em>: in the case of <a href="http://semantix.gr/taste">the work I've done</a> for the European Space Agency, we've built automatic translators of ASN.1 messages towards...</p>

<ul>
<li><p>Code generated by modelling tools: building automatic 'translators' of code generated by modelling tools to/from ASN.1, we can then use ASN.1 as the center of a star-formation, and have code generated by one modelling tool automatically "speak" to code generated by another, at runtime:</p>

<ul>
<li>Simulink Real-time workshop</li>
<li>SCADE</li>
<li>ObjectGeode and <a href="http://www.opengeode.net">OpenGeode</a></li>
<li>Real-time Developer Studio</li>
</ul></li>
<li><p>SQL databases: we can automatically store and retrieve arbitrarily complex ASN.1 messages inside automatically constructed databases (no, not via BLOBs - with tables that perfectly mirror the relationships between types using foreign keys: </p>

<ul>
<li>PostgreSQL</li>
<li>MySQL</li>
<li>SQLite</li>
<li>...and many other SQLAlchemy-supported DB engines (<em><a href="http://taste.tuxfamily.org/wiki/index.php?title=Technical_topic:_ASN.1_and_SQL_mapping">more details</a> in the TASTE wiki</em>).</li>
</ul></li>
<li><p><a href="AutoGUI2.png" rel="lightbox" title="Automatic GUIs">Automatically generated graphical user interfaces</a> receiving and sending TM/TCs (Telemetry and Telecommands) to and from our satellites.</p></li>
<li><p><a href="http://semantix.gr/assert/mscTracer.png" rel="lightbox" title="Automatic Tracers">Automatically generated graphical message tracers</a> to allow for graphical monitoring of what happens to a running system  - and why.</p></li>
<li><p><a href="icd.png" rel="lightbox" title="Automatic Interface Control Documents (ICDs)">Automatically generated Interface Control Documents (ICDs)</a> that describe the binary representation of the stream -  for those people, that for whatever reason, choose to write encoders/decoders on their own:</p></li>
<li><p>...and loads more. Visit <a href="http://www.semantix.gr/assert/">this</a> for a 5 min showcase, or <a href="http://taste.tuxfamily.org">the official site</a> for more info. You can also peruse the <a href="http://download.tuxfamily.org/taste/snapshots/doc/taste-documentation-current.pdf">manual</a> and see how ASN.1 (and AADL) allowed us to describe complex real-time embedded systems and their messages, in succinct ways that generate optimal code.</p></li>
</ul>

<h3>Two examples of ASN.1-based mappers: A SWIG-based python wrapper, and a SQL exporter</h3>

<p>The following is a hands-on example of how our <a href="http://www.swig.org/">SWIG</a>-based Python mapper - bundled in our DMT tools - wraps around the UPER C functions generated by ASN1SCC, and allows Python code to speak with ASN.1 UPER encoded data:</p>

<pre><code>$ cat sample.asn
</code></pre>

<div class='codegenWrapper'>
<pre><tt><span class="normal">MY</span><span class="symbol">-</span><span class="normal">MODULE </span><span class="keyword">DEFINITIONS</span><span class="normal"> </span><span class="keyword">AUTOMATIC</span><span class="normal"> </span><span class="keyword">TAGS</span><span class="normal"> </span><span class="symbol">::=</span><span class="normal"> </span><span class="keyword">BEGIN</span>

<span class="normal">Message </span><span class="symbol">::=</span><span class="normal"> </span><span class="type">SEQUENCE</span><span class="normal"> {</span>
<span class="normal">    msgId </span><span class="type">INTEGER</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">..</span><span class="number">10000</span><span class="symbol">),</span>
<span class="normal">    myflag  </span><span class="type">INTEGER</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">..</span><span class="number">255</span><span class="symbol">),</span>
<span class="normal">    value </span><span class="type">REAL</span><span class="symbol">(</span><span class="number">0.0</span><span class="normal"> </span><span class="symbol">..</span><span class="normal"> </span><span class="number">3.14159</span><span class="symbol">),</span>
<span class="normal">    szDescription </span><span class="type">OCTET STRING</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SIZE</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">..</span><span class="number">10</span><span class="symbol">)),</span>
<span class="normal">    isReady </span><span class="type">BOOLEAN</span>
<span class="normal">}</span>

<span class="keyword">END</span>
</tt></pre>
</div>

<pre><code>$ mkdir pythonOutput
$ asn2dataModel.py -toPython -o pythonOutput/ sample.asn
$ cd pythonOutput
$ make -f Makefile.python
$ ...
</code></pre>

<p>... which then gives you a full API over your ASN.1 types, through Python classes:</p>

<pre><code>$ cat test.py
</code></pre>

<div class='codegenWrapper'>
<pre><tt><span class="preproc">from</span><span class="normal"> sample_asn </span><span class="preproc">import</span><span class="normal"> </span><span class="symbol">*</span>

<span class="comment"># Create a buffer big enough for the maximum form of the PER-encoded data)</span>
<span class="normal">d1 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">DataStream</span><span class="symbol">(</span><span class="normal">DV</span><span class="symbol">.</span><span class="normal">Message_REQUIRED_BYTES_FOR_ENCODING</span><span class="symbol">)</span>

<span class="comment"># Create an instance of the message and set the fields)</span>
<span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="function">Message</span><span class="symbol">()</span>
<span class="normal">msg</span><span class="symbol">.</span><span class="normal">msgId</span><span class="symbol">.</span><span class="function">Set</span><span class="symbol">(</span><span class="number">5</span><span class="symbol">)</span>
<span class="normal">msg</span><span class="symbol">.</span><span class="normal">myflag</span><span class="symbol">.</span><span class="function">Set</span><span class="symbol">(</span><span class="number">15</span><span class="symbol">)</span>
<span class="normal">msg</span><span class="symbol">.</span><span class="normal">value</span><span class="symbol">.</span><span class="function">Set</span><span class="symbol">(</span><span class="number">2.718</span><span class="symbol">)</span>
<span class="normal">msg</span><span class="symbol">.</span><span class="normal">szDescription</span><span class="symbol">.</span><span class="function">SetFromPyString</span><span class="symbol">(</span><span class="string">"Hello!"</span><span class="symbol">)</span>
<span class="normal">msg</span><span class="symbol">.</span><span class="normal">isReady</span><span class="symbol">.</span><span class="function">Set</span><span class="symbol">(</span><span class="normal">True</span><span class="symbol">)</span>

<span class="comment"># Encode the message as per ASN.1 UPER encoding rules</span>
<span class="normal">msg</span><span class="symbol">.</span><span class="function">Encode</span><span class="symbol">(</span><span class="normal">d1</span><span class="symbol">)</span>

<span class="comment"># Get the encoded binary data - send them with sockets/pipes/whatever...</span>
<span class="normal">b </span><span class="symbol">=</span><span class="normal"> d1</span><span class="symbol">.</span><span class="function">GetPyString</span><span class="symbol">()</span>

<span class="comment"># ...and eventually place them in a buffer and use them </span>
<span class="comment"># as a source for decoding on the receiver code:</span>

<span class="normal">d2 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">DataStream</span><span class="symbol">(</span><span class="normal">DV</span><span class="symbol">.</span><span class="normal">Message_REQUIRED_BYTES_FOR_ENCODING</span><span class="symbol">)</span>
<span class="normal">d2</span><span class="symbol">.</span><span class="function">SetFromPyString</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">)</span>
<span class="normal">msgReceived </span><span class="symbol">=</span><span class="normal"> </span><span class="function">Message</span><span class="symbol">()</span>
<span class="normal">msgReceived</span><span class="symbol">.</span><span class="function">Decode</span><span class="symbol">(</span><span class="normal">d2</span><span class="symbol">)</span>

<span class="keyword">print</span><span class="normal"> </span><span class="string">"Received msgId:"</span><span class="symbol">,</span><span class="normal"> msgReceived</span><span class="symbol">.</span><span class="normal">msgId</span><span class="symbol">.</span><span class="function">Get</span><span class="symbol">()</span>
<span class="keyword">print</span><span class="normal"> </span><span class="string">"\nAll fields:\n"</span>
<span class="normal">msgReceived</span><span class="symbol">.</span><span class="function">PrintAll</span><span class="symbol">()</span>
</tt></pre>
</div>    

<pre><code>$ python ./test.py
Received msgId: 5

All fields:

msgId:
    5
myflag:
    15
value:
    2.718
szDescription:
    Hello!
isReady:
    True
$
</code></pre>

<p>The code shows a full round-trip that passes from structure, to byte buffer, and back to structure.</p>

<p>Similarly, here's our SQL mapper, automatically generating the SQL schema for storing/retrieving our messages:</p>

<pre><code>$ asn2dataModel.py -toSQL sample.asn

$ ls -l
total 16
drwxr-xr-x  2 ttsiod ttsiod 4096 Jun 20 11:15 ./
drwxr-xr-x 18 ttsiod ttsiod 4096 Jun 20 10:55 ../
-rw-r--r--  1 ttsiod ttsiod  261 Jun 20 11:15 sample.asn
-rw-r--r--  1 ttsiod ttsiod 1232 Jun 20 11:15 sample.sql

$ cat sample.sql
</code></pre>

<div class='codegenWrapper'>
<pre><tt><span class="comment">--  SQL statements for types used in "sample.asn"</span>

<span class="keyword">CREATE</span><span class="normal"> </span><span class="keyword">TABLE</span><span class="normal"> Message_msgId </span><span class="symbol">(</span>
<span class="normal">    id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">PRIMARY</span><span class="normal"> </span><span class="keyword">KEY</span><span class="symbol">,</span>
<span class="normal">    </span><span class="keyword">data</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">CHECK</span><span class="symbol">(</span><span class="keyword">data</span><span class="symbol">&gt;=</span><span class="number">0</span><span class="normal"> </span><span class="keyword">and</span><span class="normal"> </span><span class="keyword">data</span><span class="symbol">&lt;=</span><span class="number">10000</span><span class="symbol">)</span>
<span class="symbol">);</span>

<span class="keyword">CREATE</span><span class="normal"> </span><span class="keyword">TABLE</span><span class="normal"> Message_myflag </span><span class="symbol">(</span>
<span class="normal">    id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">PRIMARY</span><span class="normal"> </span><span class="keyword">KEY</span><span class="symbol">,</span>
<span class="normal">    </span><span class="keyword">data</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">CHECK</span><span class="symbol">(</span><span class="keyword">data</span><span class="symbol">&gt;=</span><span class="number">0</span><span class="normal"> </span><span class="keyword">and</span><span class="normal"> </span><span class="keyword">data</span><span class="symbol">&lt;=</span><span class="number">255</span><span class="symbol">)</span>

<span class="symbol">...</span>

<span class="keyword">CREATE</span><span class="normal"> </span><span class="keyword">TABLE</span><span class="normal"> Message </span><span class="symbol">(</span>
<span class="normal">    id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span>
<span class="normal">    msgId_id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span>
<span class="normal">    myflag_id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span>
<span class="normal">    value_id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span>
<span class="normal">    szDescription_id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span>
<span class="normal">    isReady_id </span><span class="type">int</span><span class="normal"> </span><span class="keyword">NOT</span><span class="normal"> </span><span class="keyword">NULL</span><span class="symbol">,</span>
<span class="normal">    CONSTRAINT Message_pk </span><span class="keyword">PRIMARY</span><span class="normal"> </span><span class="keyword">KEY</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">),</span>
<span class="normal">    CONSTRAINT msgId_fk </span><span class="keyword">FOREIGN</span><span class="normal"> </span><span class="keyword">KEY</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">msgId_id</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">REFERENCES</span><span class="normal"> Message_msgId</span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">),</span>
<span class="normal">    CONSTRAINT myflag_fk </span><span class="keyword">FOREIGN</span><span class="normal"> </span><span class="keyword">KEY</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">myflag_id</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">REFERENCES</span><span class="normal"> Message_myflag</span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">),</span>
<span class="normal">    CONSTRAINT value_fk </span><span class="keyword">FOREIGN</span><span class="normal"> </span><span class="keyword">KEY</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">value_id</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">REFERENCES</span><span class="normal"> Message_value</span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">),</span>
<span class="normal">    CONSTRAINT szDescription_fk </span><span class="keyword">FOREIGN</span><span class="normal"> </span><span class="keyword">KEY</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">szDescription_id</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">REFERENCES</span><span class="normal"> Message_szDescription</span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">),</span>
<span class="normal">    CONSTRAINT isReady_fk </span><span class="keyword">FOREIGN</span><span class="normal"> </span><span class="keyword">KEY</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">isReady_id</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">REFERENCES</span><span class="normal"> TaStE_Isready_type</span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">));</span>
<span class="normal">$ </span>
</tt></pre>
</div>

<p>As you can see, the transformation is also converting ASN.1 constraints to SQL constraints - and more importantly, works <em>regardless of the complexity of the message</em>.</p>

<h2>Conclusion</h2>

<p>Putting it simply: ASN.1 is another technology that is optimal for certain problem domains - and yet people will ignore it and pay the penalty in performance, memory and robustness.</p>

<p>By modelling your system's messages, ASN.1 also allows for lots of automatic code generation. In our case, we identified tremendous opportunities for automation, and have made a number of ASN.1-based code generators, that, among other things, automatically...</p>

<ul>
<li>generate graphical user interfaces</li>
<li>integrate code generated by different modelling tools </li>
<li>generate formal wire-format documentation</li>
<li>generate Python classes that serialize instances of the ASN.1 types to/from a database (regardless of database engine).</li>
<li>generate the skeleton code of an FPGA (.vhdl files) as well as the complete software driver that will speak to it at runtime, interfacing it with any other code that speaks ASN.1</li>
<li>etc...</li>
</ul>

<p>Fellow developers, have a look. You may find out ASN.1 can make your work easier, simpler, and more efficient.</p>

<h2>Notes</h2>

<ol>
<li><p><a name="nevermindthem"></a>If you are unfortunate enough to come into contact with lots of Telecom standards, you will often see how a simple and useful idea can become ridiculously complex as feature creep takes hold. To whatever extent you can, resist this - in the case of ASN.1, I humbly suggest that you use only the basic principles: type specification and constraints.</p></li>
<li><p><a name="fsharp"></a>The compiler is an F# application, so it can run (via <a href="http://www.mono-project.com/">Mono</a>) under Linux and OS X, or natively under Windows (to put it simply: it works on all major platforms). Why it is written in F# is a matter for another blog post - suffice to say, <a href="http://ocaml.org/">OCaml</a> (the mother of F#) is a language with a strong type system that prevents <strong>many</strong> potential issues, detecting them at compile-time. It is very important for any code generator (and an ASN.1 compiler is exactly that!) to detect as many errors as possible at compile-time.</p></li>
<li><p><a name="ByteStream"></a>Since ASN1SCC targets embedded platforms, memory is an issue (we don't want to allocate stuff from the heap, since the heap may run out - when you're in space, what can you do if you run out of heap?...). The compiler therefore emits <code>#define</code>s that allow us to reserve the necessary memory during compile-time:</p></li>
</ol>

<div class='codegenWrapper'>
<pre><tt><span class="type">void</span><span class="normal"> </span><span class="function">foo</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">Message</span><span class="normal"> decodedPDU</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">byte</span><span class="normal"> encBuff</span><span class="symbol">[</span><span class="normal">Message_REQUIRED_BYTES_FOR_ENCODING</span><span class="symbol">];</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">BitStream</span><span class="normal"> bitStrm</span><span class="symbol">;</span>

<span class="normal">    </span><span class="function">BitStream_Init</span><span class="symbol">(&amp;</span><span class="normal">bitStrm</span><span class="symbol">,</span><span class="normal"> encBuff</span><span class="symbol">,</span><span class="normal"> Message_REQUIRED_BYTES_FOR_ENCODING</span><span class="symbol">);</span>
<span class="normal">    ret </span><span class="symbol">=</span><span class="normal"> </span><span class="function">Message_Encode</span><span class="symbol">(</span><span class="normal">pVal</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">bitStrm</span><span class="symbol">,</span><span class="normal"> pErrCode</span><span class="symbol">,</span><span class="normal"> TRUE</span><span class="symbol">);</span>
<span class="normal">    </span><span class="symbol">...</span>
</tt></pre>
</div>

<br>
    <hr>
    <div style='margin-top:1em'>
        <div style='float:left'>
            <a target="_blank" href="https://stackoverflow.com/users/382050/ttsiodras">
                <img src="382050.png" width="208" height="58" alt="profile for ttsiodras at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for ttsiodras at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
            </a>
        </div>
        <div style='float:left; margin-left:1em'>
            <a target="_blank" href="https://github.com/ttsiodras">
                <img border="1" src="github.png" alt='GitHub member ttsiodras' title='GitHub member ttsiodras'>
            </a>
        </div>
        <!--div style='float:left; margin-left:1em'>
            <a target="_blank" href="https://projecteuler.net/profile/ttsiodras.png">
                <img src="https://projecteuler.net/profile/ttsiodras.png" alt='Project Euler member ttsiodras' title='Project Euler member ttsiodras'>
            </a>
        </div-->
    </div>
    <div style='clear:both; margin-bottom:0.5em'></div>

<!-- Used to do this with float:right, but Opera Mini shows nothing with it... back to tables :-( -->
<table summary="Footer" width="100%" border="0"><tr><td><a href="index.html">Back to index</a>&nbsp;&nbsp;<a href="cv.pdf">My CV</a>&nbsp;&nbsp;<a href="https://plus.google.com/+ThanassisTsiodras/about">About me</a></td><td align="right"><em>Last update on: Sun Feb 21 12:56:49 2016</em>&nbsp;(<a href="//validator.w3.org/check?uri=referer"><em>Valid HTML</em></a>)</td></tr></table>

            <hr style="margin-bottom: 1em">
            <script src="urchin.js" type="text/javascript"></script>
            <script type="text/javascript">_uacct = "UA-746316-1";urchinTracker();</script>
            <p id="disqus_thread">
                The comments on this website require the use of JavaScript. Perhaps your browser isn't
                JavaScript capable or the script is not being run for another reason. If you're
                interested in reading the comments or leaving a comment behind please try again with a
                different browser or from a different connection.
            </p>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'ttsiodras';
                var disqus_identifier = '../content/asn1.content';

                (function() {
                    'use strict';

                    /**
                     * This method will handle the click on the button to load the comments. It will remove the
                     * button and execute the original Disqus script for loading the comments.
                     */
                    function button_clickHandler(event) {
                        // We need to get the button element, we could also use the target property of the event
                        // but this will do just as well
                        var button = document.getElementById('disqus_thread');
                        // Now we will have to recreate the div element we removed from the HTML. We will place
                        // it into the DOM like we did when we created the button
                        var disqusContainer = document.createElement('div');
                        button.parentNode.insertBefore(disqusContainer, button);
                        button.parentNode.removeChild(button);

                        // The div element will need to have the disqus_thread id as this is required for Disqus,
                        // it is the way their code identifies the element in which the comments can be displayed
                        disqusContainer.id = 'disqus_thread';

                        // Now we can execute the original Disqus code
                        var dsq = document.createElement('script');
                        dsq.type = 'text/javascript';
                        dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    }

                    /**
                     * This method will initialize the module. It will replace the JavaScript dependency message
                     * with a button which will allow the visitor to load the comments.
                     */
                    function init() {
                        // Try to get the element we used to display the message about the JavaScript dependency
                        var placeholder = document.getElementById('disqus_thread');
                        // If we didn't get the placeholder element we will stop setting up the button to load
                        // the comments
                        if (placeholder == null) {
                            return;
                        }

                        // The placeholder was found, now we can create the button which will allow the visitor to
                        // load the comments
                        var button = document.createElement('button');
                        button.appendChild(document.createTextNode('Click here to see the comments (powered by Disqus)'));
                        button.addEventListener('click', button_clickHandler.bind(this));

                        // We will insert the button before the placeholder and once the button has been placed in
                        // the DOM we will remove the placeholder
                        placeholder.parentNode.insertBefore(button, placeholder);
                        placeholder.parentNode.removeChild(placeholder);

                        // The placeholder used to have the id which can be reference by an anchor element, to make
                        // sure we don't break this functionality we will apply the id to our newly created button
                        button.id = 'disqus_thread';
                    }

                    // Setup the module
                    init();
                })();
            </script>
        </div>
    </div>
</body>
</html>
