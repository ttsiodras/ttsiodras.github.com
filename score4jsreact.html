<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://www.thanassis.space/score4jsreact.html">
<meta name="author" content="Thanassis Tsiodras">
<meta name="author" content="Athanasios Tsiodras">
<meta name="author" content="ttsiod">
<meta name="author" content="ttsiodras">
<meta name="description" content="Porting my Score4 game to React/TypeScript">
<link type="text/css" rel="stylesheet" href="final-code-wavetheory-lightbox.css">
<link type="application/rss+xml" rel="alternate" href="rss.xml" title="Coding and administration articles by ttsiodras">
<title>Porting my Score4 game to React/TypeScript</title>
</head>
<body>
    <div class="well" id="Page">
        <div id="Banner">Porting my Score4 game to React/TypeScript</div>
        <div id="MainContent">
            <p><em>(September 2015)</em></p>

<p><link rel="stylesheet" href="matrix.css"></p>

<script src="react.js"></script>
<script type="text/javascript">
var Score4_AI=(function(){function a(d){this.board=d;var b=navigator.platform+","+navigator.userAgent;var c=function(e){if(/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))){return 5}else{return 6}};this.defaultDepth=c(navigator.userAgent||navigator.vendor)}a.inside=function(c,b){return c>=0&&c<a.height&&b>=0&&b<a.width};a.prototype.CheckWinner=function(){var e=this.board;var h,f,j;for(f=0;f<a.height;f++){for(h=0;h<a.width;h++){for(var g=0;g<4;g++){var c=0;for(j=0;j<4;j++){var b=a.steps[g][j][0];var d=a.steps[g][j][1];if(a.inside(f+b,h+d)){var i=e[f+b][h+d];if(i==1||i==-1){c+=i}}}if(c==4||c==-4){for(j=0;j<4;j++){b=a.steps[g][j][0];d=a.steps[g][j][1];if(a.inside(f+b,h+d)){this.board[f+b][h+d]=c}}return{allDone:true,winner:c}}}}}for(h=0;h<a.width;h++){if(e[0][h]==0){return{allDone:false,winner:0}}}return{allDone:true,winner:0}};a.prototype.dropDiskMutate=function(c,b){for(var d=a.height-1;d>=0;d--){if(this.board[d][c]===0){this.board[d][c]=b;return d}}return -1};a.prototype.minimax=function(i,f,g){var b=this.board;if(0===g){return[-1,this.ScoreBoard()]}else{var d=i?-10000000:10000000;var j=-1;for(var e=0;e<a.width;e++){if(b[0][e]!==0){continue}var c=this.dropDiskMutate(e,f);if(c===-1){continue}var l=this.ScoreBoard();if(l==(i?a.orangeWins:a.yellowWins)){j=e;d=l;b[c][e]=0;break}var k=this.minimax(!i,f==1?-1:1,g-1);var h=k[1];b[c][e]=0;if(h==a.orangeWins||h==a.yellowWins){h-=g*f}if(i){if(h>=d){d=h;j=e}}else{if(h<=d){d=h;j=e}}}return[j,d]}};a.prototype.ScoreBoard=function(){var d=[0,0,0,0,0,0,0,0,0];var c,g,f,b;var e=this.board;for(g=0;g<a.height;g++){f=e[g][0]+e[g][1]+e[g][2];for(c=3;c<a.width;c++){f+=e[g][c];d[f+4]++;f-=e[g][c-3]}}for(c=0;c<a.width;c++){f=e[0][c]+e[1][c]+e[2][c];for(g=3;g<a.height;g++){f+=e[g][c];d[f+4]++;f-=e[g-3][c]}}for(g=0;g<a.height-3;g++){for(c=0;c<a.width-3;c++){f=0;for(b=0;b<4;b++){f+=e[g+b][c+b]}d[f+4]++}}for(g=3;g<a.height;g++){for(c=0;c<a.width-3;c++){f=0;for(b=0;b<4;b++){f+=e[g-b][c+b]}d[f+4]++}}if(d[0]!==0){return a.yellowWins}else{if(d[8]!==0){return a.orangeWins}else{return d[5]+2*d[6]+5*d[7]-d[3]-2*d[2]-5*d[1]}}};a.width=7;a.height=6;a.orangeWins=1000000;a.yellowWins=-1000000;a.steps=[[[0,0],[-1,1],[-2,2],[-3,3]],[[0,0],[0,1],[0,2],[0,3]],[[0,0],[1,1],[2,2],[3,3]],[[0,0],[1,0],[2,0],[3,0]]];return a})();var __extends=(this&&this.__extends)||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e]}}function c(){this.constructor=f}f.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c())};var Score4=(function(b){__extends(a,b);function a(){b.call(this);this.reset();this.state.wins=0;this.state.losses=0;this.brain=new Score4_AI(this.state.board);this.state.brain_depth=this.brain.defaultDepth;this.state.viewport_size=a.getViewportSize();this.state.canClick=true}a.getViewportSize=function(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)};a.prototype.componentDidMount=function(){window.addEventListener("resize",this.handleResize.bind(this))};a.prototype.handleResize=function(){this.setState({viewport_size:a.getViewportSize()})};a.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.handleResize.bind(this))};a.prototype.dropDisk=function(c,e,d){var f=c;for(var g=Score4_AI.height-1;g>=0;g--){if(f[g][e]===0){f[g]=f[g].slice(0);f[g][e]=d;return f}}return null};a.prototype.gameOver=function(){return this.state.info===a.GAME_OVER_MESSAGE};a.prototype.checkEndGame=function(f,c,e){var g,d=this.brain.CheckWinner();if(d.allDone){if(d.winner==4){this.state.losses++}else{if(d.winner==-4){this.state.wins++}}g=a.GAME_OVER_MESSAGE;e=false}else{g=f()}this.setState({board:c(),info:g,canClick:e});return d.allDone};a.prototype.handleClick=function(c){var e=this;if(!this.state.canClick){return}if(this.gameOver()){return}var d=this.dropDisk(this.state.board,c,-1);this.brain.board=d;if(this.checkEndGame(function(){return"Thinking, please wait..."},function(){return(d!==null?d:e.state.board)},false)){return}setTimeout(this.playMove.bind(this),100)};a.prototype.playMove=function(){var f=this;var e=new Date();var c=this.brain.minimax(true,1,this.state.brain_depth);var d=new Date();if(c[0]!=-1){this.brain.board=this.state.board;this.brain.dropDiskMutate(c[0],1);this.state.canClick=true}this.checkEndGame(function(){return"CPU was thinking for "+(d.getTime()-e.getTime())/1000+" seconds."},function(){return f.state.board},true)};a.prototype.reset=function(){if(this.state===undefined||this.state===null){this.state={}}this.state.board=[];for(var g=0;g<Score4_AI.height;g++){var f=[];for(var c=0;c<Score4_AI.width;c++){f.push(0)}this.state.board.push(f)}var d=Score4_AI.height-1;var e=Math.floor(Score4_AI.width/2);this.state.board[d][e]=1;this.state.info="Click on any column to drop a green chip...";this.state.canClick=true};a.prototype.render=function(){var j=this;var f=this;var d=function(){f.reset();j.setState(j.state)};var h=function(){if(j.state.brain_depth>2){j.setState({brain_depth:j.state.brain_depth-1})}};var g=function(){if(j.state.brain_depth<j.brain.defaultDepth+1){j.setState({brain_depth:j.state.brain_depth+1})}};var c=function(l,k){return(React.createElement("td",{key:k,style:{cursor:"pointer"},onClick:f.handleClick.bind(f,k)},React.createElement("div",{className:(function(){switch(f.state.board[l][k]){case 4:return"red_won_coin";case 1:return"red_coin";case -1:return"green_coin";case -4:return"green_won_coin";default:return"no_coin"}})()})))};var i=function(k){return String(k)+" victor"+(k===1?"y.":"ies.")};var e=function(m){var k=[];for(var l=0;l<m;l++){k.push(l)}return k};return(React.createElement("div",null,React.createElement("table",null,React.createElement("tr",null,(function(){var k=[];if(j.state.viewport_size>640){k.push(React.createElement("td",{style:{"min-width":"7em","text-align":"center"}},React.createElement("div",{style:{"vertical-align":"middle"}},React.createElement("span",{style:{color:"green",align:"right"}},React.createElement("b",null,"You"),":"),React.createElement("br",null),i(j.state.wins))))}k.push(React.createElement("td",null,React.createElement("table",{className:"grid_table"},e(Score4_AI.height).map(function(l){return(React.createElement("tr",{key:l},e(Score4_AI.width).map(function(m){return c(l,m)})))})),React.createElement("div",{style:{"text-align":"center"}},React.createElement("p",null,j.state.info)),React.createElement("div",null,React.createElement("button",{type:"button",onClick:d,style:{"float":"left"}},React.createElement("b",null,"New game")),React.createElement("div",{style:{"float":"right"}},React.createElement("button",{type:"button",onClick:h},React.createElement("b",null,"Be dumber!")),React.createElement("span",{style:{width:10}}," "),j.state.brain_depth," moves ahead",React.createElement("span",{style:{width:10}}," "),React.createElement("button",{type:"button",onClick:g},React.createElement("b",null,"Be smarter!"))))));if(j.state.viewport_size>640){k.push(React.createElement("td",{style:{"min-width":"7em","text-align":"center"}},React.createElement("div",{style:{"vertical-align":"middle"}},React.createElement("span",{style:{color:"red",align:"right"}},React.createElement("b",null,"CPU"),":"),React.createElement("br",null),i(j.state.losses))))}return k})()))))};a.prototype.showComponent=function(){React.render(React.createElement(a,null),document.getElementById("board"))};a.GAME_OVER_MESSAGE="GAME OVER - Try again?";return a})(React.Component);(function(b,a,c){b.onload=function(){var d=new Score4();d.showComponent()}})(window,document,undefined);
</script>

<p><a href="https://github.com/ttsiodras/ReactJS-Score4"><img src="forkme_right_darkblue_121621.png" style="position: fixed; right: 0; top: 0;" alt="Fork me on GitHub"></a>
<b>For the TL;DR crowd:</b>
<p><em>If you are are a developer, read on to see 
how I ported some old code from <b>JavaScript and Canvas</b> (i.e.&nbsp;dynamically-typed,
imperative drawing) to <b>TypeScript and React/JSX</b> (statically-typed,
functional style, state-driven - with compile-time checks of HTML syntax).
The code can be downloaded from 
<a href="https://github.com/ttsiodras/ReactJS-Score4">here</a>.</p>

<p>And developer or not, you have to play Score4 below... and try to beat my AI :-)</em>
<p>
    <a name="playnow"></a> 
    <div id="board" align="center"></div></p>

<h2>From JS/Canvas, to...</h2>

<div class="scrollableContainer rightFloat">
<img hspace="10" vspace="10" alt="Score4 - Connect4" src="connect-four.jpg"><br>
<em>The Score 4 (Connect 4) game.</em>
</div>

<p>Four years ago I implemented
<a href="score4.html">the AI Minimax algorithm</a> and used it to play a game called
<a href="https://en.wikipedia.org/wiki/Connect_Four">Score4 / ConnectFour</a>.
<p>
I did this after discovering the difference of doing things in functional
(as opposed to imperative) style, coding it
<a href="https://github.com/ttsiodras/Score4">in many languages</a>,
and finally <a href="score4js.html">porting it to Javascript</a>.
The game was now accessible to any machine with a decent browser.
Phones, tablets, desktops and laptops could all play it - One Platform
to Rule Them All :-)
<p>Years passed...
<p>And as they did, the programming world - as usual - re-discovered some old truths...
<p>...which I wanted to put to the test.</p>

<h3>GUIs are hard - meet
    <a href="https://reactjs.org/">React</a></h3>
GUIs are very hard to code properly ; but can be
created in an easier way, if you represent your user interface
as a function, that gets your state as input. Whenever your state
changes, you call that function, and its job is to make sure
that your new state shows up.
<p>
Equally important - this
"<a href="https://facebook.github.io/jsx/">magic function</a>"
can actually do a significant optimization:
it can see which parts of your UI
are associated with which parts of your state, and only update
the displayed parts <em>that were actually impacted</em> by
your state changes.
<p>Clearer code **and** faster execution - could it be true?
<h3>Return of the Types - meet
<a href="https://www.typescriptlang.org/">TypeScript</a>
</h3>

<p>I love <a href="python.html">Python</a> ; and appreciate Javascript
and Clojure the Powerful, and generally speaking, the clarity
and brevity that usually accompanies dynamically typed languages.
You don't prefix each and every one of your variables
with type specifications, so only the "core" of your logic
is left behind. Go the extra mile and avoid loops, using
immutable <code>map</code>s and <code>filter</code>s and
<code>fold</code>s, and you're all set&nbsp;:&#x2011;)
<p>
But let's be honest about something.
<p>The lack of these type specifications means...
that the errors that were traditionally caught
by compilers... now blow up in your face.
<p>At run-time.
With your clients yelling at your support people.
<p>And when you need to refactor... you must be <em>really</em>
careful. As in, you have to create big test suites,
and make sure they exercise large parts of your code
(also known as "be religious about your test suite's 
code coverage"...). If you don't, code refactoring becomes
<b>an interesting exercise</b>.</p>

<div>
    <center>
    <img
        hspace="20" vspace="10"
        alt="teething baby biting snake"
        src="indiana.jpg"><br>
        <em>I love Python</em>
    </center>
</div>

<p><p>In hindsight, I think we gave up on compile-time checks too easily...
what we really "longed for" was in fact cleaner, more expressive syntax
(<em>OK - that, and the rapid edit-run cycles</em>). Personally,
I've immersed my backend work in PyLint and Pyflakes and PyCharm's
inspector... but all those tools still don't compare with what a language
with a strong type system provides.
<p>
And as fate would have it, in the frontend,
<a href="https://www.typescriptlang.org/">TypeScript</a> - an open-source
statically typed language that builds on top of Javascript,
recently acquired support for a big part of React: JSX syntax.</p>

<h2>Time to play</h2>

<p>That was all the incentive I needed - I wanted to taste React for quite
some time, so I decided to put these two technologies to the test.
<p>
To make the test more representative of what a real application would do,
I also wanted to try to make my UI as declarative as possible - which
means that instead of using imperative Canvas drawing
commands, I wanted to switch the code to CSS-based rendering of the
game's board.</p>

<h3>Step 1: CSS</h3>

<p>I started with the easy part - removing all the Canvas drawing code, and
all the related artifacts... like <em>mouse-click-to-column-mapping</em> code.
This would now be handled by <code>onClick</code> DOM handlers.
<p>
I then had to figure out how to create a board using only HTML/CSS. I am not
a frontend engineer, so... this required a bit of digging. Eventually
I settled on a simple HTML table, with CSS-generated circles as tiles
(inside the table cells).</p>

<div class='codegenWrapper'>
<pre><tt><span class="selector">.no_coin</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="property">width:</span><span class="normal"> </span><span class="value">50px</span><span class="normal">;</span>
<span class="normal">    </span><span class="property">height:</span><span class="normal"> </span><span class="value">50px</span><span class="normal">;</span>
<span class="cbracket">}</span>

<span class="selector">.red_coin</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="property">border-radius:</span><span class="normal"> </span><span class="value">50%</span><span class="normal">;</span>
<span class="normal">    </span><span class="property">width:</span><span class="normal"> </span><span class="value">50px</span><span class="normal">;</span>
<span class="normal">    </span><span class="property">height:</span><span class="normal"> </span><span class="value">50px</span><span class="normal">;</span>
<span class="normal">    </span><span class="property">display:</span><span class="normal"> </span><span class="value">inline-block</span><span class="normal">;</span>
<span class="normal">    </span><span class="property">background:</span><span class="normal"> </span><span class="value">red</span><span class="normal">;</span>
<span class="cbracket">}</span>
</tt></pre>
</div>If a div has a class of <code>red-coin</code> then it will show up
in the board's table as a red game tile:

<div class='codegenWrapper'>
<pre><tt><span class="keyword">&lt;table</span><span class="normal"> </span><span class="type">class</span><span class="symbol">=</span><span class="string">"grid_table"</span><span class="keyword">&gt;</span>
<span class="normal">    </span><span class="keyword">&lt;tr&gt;</span>
<span class="normal">        </span><span class="keyword">&lt;td&gt;&lt;div</span><span class="normal"> </span><span class="type">class</span><span class="symbol">=</span><span class="string">"red_coin"</span><span class="keyword">&gt;&lt;/td&gt;</span><span class="normal">&lt;</span>
<span class="normal">        ...</span>
</tt></pre>
</div><div>
    <center>
    <img
        hspace="10" vspace="10"
        alt="red tile"
        src="red-circle.png"><br>
    </center>
</div>

<h3>Step 2: State</h3>

<p>Next step: <em>state</em>... What is the state of my game - the one that influences
my UI?
<p>
Well...</p>

<ul>
    <li>There's the board itself, obviously. I use -1, 0 and 1 to represent
        the tile values (green, empty, red) so it's a <code>number[][]</code>
    <li>There's the message I show to the player - a <code>string</code>
    <li>There's the wins / losses counter (two <code>number</code>s).
</ul>

<p>And that's it, really:</p>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">class</span><span class="normal"> Score4State </span><span class="cbracket">{</span>
<span class="normal">    board</span><span class="symbol">:</span><span class="normal"> number</span><span class="symbol">[][];</span>
<span class="normal">    info</span><span class="symbol">:</span><span class="normal"> string</span><span class="symbol">;</span>
<span class="normal">    wins</span><span class="symbol">:</span><span class="normal"> number</span><span class="symbol">;</span>
<span class="normal">    losses</span><span class="symbol">:</span><span class="normal"> number</span><span class="symbol">;</span>
<span class="cbracket">}</span>
</tt></pre>
</div>

<p>Given an instance of this state, how do we render it with React to the table elements
that compose our UI?</p>

<h3>Step 3: JSX</h3>

<p>Turns out this part was easier than I thought.
We begin by telling React to render our Score4 component in our page,
at the place where we have a <code>board</code> div:</p>

<div class='codegenWrapper'>
<pre><tt><span class="function">showComponent</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    React</span><span class="symbol">.</span><span class="function">render</span><span class="symbol">(</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">Score4 </span><span class="symbol">/&gt;,</span><span class="normal"> document</span><span class="symbol">.</span><span class="function">getElementById</span><span class="symbol">(</span><span class="string">'board'</span><span class="symbol">));</span>
<span class="cbracket">}</span>
</tt></pre>
</div>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">&lt;div</span><span class="normal"> </span><span class="type">id</span><span class="symbol">=</span><span class="string">"board"</span><span class="normal"> </span><span class="type">align</span><span class="symbol">=</span><span class="string">"center"</span><span class="keyword">&gt;&lt;/div&gt;</span>
</tt></pre>
</div>

<p>And our component will traverse the board, emitting the cells based on their state...
<p>To ease the traversal, since poor Javascript lacks a <code>range</code>, I provided
one:</p>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">var</span><span class="normal"> range </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">:</span><span class="normal">number</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=&gt;</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">var</span><span class="normal"> result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">[];</span>
<span class="normal">    </span><span class="keyword">for</span><span class="symbol">(</span><span class="keyword">var</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">&lt;</span><span class="normal">n</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span>
<span class="normal">        result</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>
</tt></pre>
</div>

<p>...and used it to loop vertically and horizontally on my board, generating
React elements as I went:</p>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">var</span><span class="normal"> proclaim </span><span class="symbol">=</span><span class="normal"> </span>
<span class="normal">    </span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">:</span><span class="normal">number</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=&gt;</span><span class="normal"> </span><span class="function">String</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="string">" victor"</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">===</span><span class="normal"> </span><span class="number">1</span><span class="symbol">?</span><span class="normal"> </span><span class="string">"y."</span><span class="symbol">:</span><span class="string">"ies."</span><span class="symbol">)</span>
<span class="symbol">;</span>
<span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span>
<span class="normal">    </span><span class="symbol">&lt;</span><span class="normal">div</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">span style</span><span class="symbol">=</span><span class="cbracket">{{</span><span class="normal">color</span><span class="symbol">:</span><span class="string">"green"</span><span class="cbracket">}}</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">b</span><span class="symbol">&gt;</span><span class="normal">You</span><span class="symbol">&lt;</span><span class="regexp">/b&gt;:&lt;/</span><span class="normal">span</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="cbracket">{</span><span class="function">proclaim</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">.</span><span class="normal">state</span><span class="symbol">.</span><span class="normal">wins</span><span class="symbol">)</span><span class="cbracket">}</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">div style</span><span class="symbol">=</span><span class="cbracket">{{</span><span class="normal">display</span><span class="symbol">:</span><span class="string">'inline-block'</span><span class="cbracket">}}</span><span class="symbol">&gt;</span>
<span class="normal">            </span><span class="symbol">&lt;</span><span class="normal">table className</span><span class="symbol">=</span><span class="cbracket">{</span><span class="string">"grid_table"</span><span class="cbracket">}</span><span class="symbol">&gt;</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">range</span><span class="symbol">(</span><span class="normal">Score4_AI</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">).</span><span class="function">map</span><span class="symbol">(</span><span class="normal"> y </span><span class="symbol">=&gt;</span><span class="normal"> </span><span class="symbol">(</span>
<span class="normal">                        </span><span class="symbol">&lt;</span><span class="normal">tr key</span><span class="symbol">=</span><span class="cbracket">{</span><span class="normal">y</span><span class="cbracket">}</span><span class="symbol">&gt;</span>
<span class="normal">                        </span><span class="cbracket">{</span>
<span class="normal">                            </span><span class="function">range</span><span class="symbol">(</span><span class="normal">Score4_AI</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">).</span><span class="function">map</span><span class="symbol">(</span><span class="normal"> </span>
<span class="normal">                                x </span><span class="symbol">=&gt;</span><span class="normal"> </span><span class="function">cellMaker</span><span class="symbol">(</span><span class="normal">y</span><span class="symbol">,</span><span class="normal"> x</span><span class="symbol">)</span>
<span class="normal">                            </span><span class="symbol">)</span>
<span class="normal">                        </span><span class="cbracket">}</span>
<span class="normal">                        </span><span class="symbol">&lt;/</span><span class="normal">tr</span><span class="symbol">&gt;</span>
<span class="normal">                    </span><span class="symbol">)</span>
<span class="normal">                </span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="symbol">&lt;/</span><span class="normal">table</span><span class="symbol">&gt;</span>
<span class="normal">            </span><span class="symbol">&lt;</span><span class="normal">p</span><span class="symbol">&gt;</span><span class="cbracket">{</span><span class="keyword">this</span><span class="symbol">.</span><span class="normal">state</span><span class="symbol">.</span><span class="normal">info</span><span class="cbracket">}</span><span class="symbol">&lt;/</span><span class="normal">p</span><span class="symbol">&gt;</span>
<span class="normal">            </span><span class="symbol">&lt;</span><span class="normal">button type</span><span class="symbol">=</span><span class="string">"button"</span><span class="normal"> onClick</span><span class="symbol">=</span><span class="cbracket">{</span><span class="normal">resetAndRepaint</span><span class="cbracket">}</span><span class="symbol">&gt;&lt;</span><span class="normal">b</span><span class="symbol">&gt;</span><span class="normal">New game</span><span class="symbol">&lt;</span><span class="regexp">/b&gt;&lt;/</span><span class="normal">button</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="symbol">&lt;/</span><span class="normal">div</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">span style</span><span class="symbol">=</span><span class="cbracket">{{</span><span class="normal">color</span><span class="symbol">:</span><span class="string">"red"</span><span class="cbracket">}}</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">b</span><span class="symbol">&gt;</span><span class="normal">CPU</span><span class="symbol">&lt;</span><span class="regexp">/b&gt;:&lt;/</span><span class="normal">span</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="cbracket">{</span><span class="function">proclaim</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">.</span><span class="normal">state</span><span class="symbol">.</span><span class="normal">losses</span><span class="symbol">)</span><span class="cbracket">}</span>
<span class="normal">    </span><span class="symbol">&lt;/</span><span class="normal">div</span><span class="symbol">&gt;</span>
<span class="symbol">);</span>
</tt></pre>
</div>

<p><p>
This looks very PHP-ish... until you realize that everything is <b>checked
for correctness at compile-time</b>. Try modifying any part of the HTML in that code, say
rename the <code>style</code> attribute to <code>styl</code>, and watch the
TypeScript compiler complain...</p>

<div class='codegenWrapper'>
<pre><tt><span class="normal">score4</span><span class="symbol">.</span><span class="normal">tsx</span><span class="symbol">(</span><span class="number">148</span><span class="symbol">,</span><span class="number">23</span><span class="symbol">):</span><span class="normal"> error TS2339</span><span class="symbol">:</span><span class="normal"> Property </span><span class="string">'styl'</span><span class="normal"> does not exist on </span><span class="keyword">type</span><span class="normal"> </span><span class="string">'HTMLAttributes'</span><span class="symbol">.&lt;</span><span class="normal">/pre</span><span class="symbol">&gt;</span>
</tt></pre>
</div>

<p>And of course that doesn't just apply to your HTML "template" - try goofing on the
code itself, mis-typing <code>yy</code> instead of <code>y</code>, and...</p>

<div class='codegenWrapper'>
<pre><tt><span class="normal">score4</span><span class="symbol">.</span><span class="normal">tsx</span><span class="symbol">(</span><span class="number">155</span><span class="symbol">,</span><span class="number">42</span><span class="symbol">):</span><span class="normal"> error TS2304</span><span class="symbol">:</span><span class="normal"> Cannot find name </span><span class="string">'yy'</span><span class="symbol">.&lt;</span><span class="normal">/pre</span><span class="symbol">&gt;</span>
</tt></pre>
</div>

<p>Complete integration between the two worlds...
<p>
<b>Wow</b>.
<p>
And you are probably wondering about that <code>cellMaker</code>; why didn't I just
emit the <code>&lt;td&gt;</code>s in my inner "loop"?
<p>
Well, that was just by choice. In my humble opinion, separating them is cleaner.
It also shows that generation of React components can be split up in whatever
manner we choose:</p>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">var</span><span class="normal"> cellMaker </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y</span><span class="symbol">:</span><span class="normal">number</span><span class="symbol">,</span><span class="normal"> x</span><span class="symbol">:</span><span class="normal">number</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=&gt;</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span>
<span class="normal">        </span><span class="symbol">&lt;</span><span class="normal">td key</span><span class="symbol">=</span><span class="cbracket">{</span><span class="normal">x</span><span class="cbracket">}</span><span class="normal"> onClick</span><span class="symbol">=</span><span class="cbracket">{</span><span class="normal">self</span><span class="symbol">.</span><span class="normal">handleClick</span><span class="symbol">.</span><span class="function">bind</span><span class="symbol">(</span><span class="normal">self</span><span class="symbol">,</span><span class="normal"> x</span><span class="symbol">)</span><span class="cbracket">}</span><span class="symbol">&gt;</span>
<span class="normal">            </span><span class="symbol">&lt;</span><span class="normal">div</span>
<span class="normal">                className</span><span class="symbol">=</span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="symbol">(()</span><span class="normal"> </span><span class="symbol">=&gt;</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">self</span><span class="symbol">.</span><span class="normal">state</span><span class="symbol">.</span><span class="normal">board</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="keyword">case</span><span class="normal">  </span><span class="number">4</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"red_won_coin"</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">case</span><span class="normal">  </span><span class="number">1</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"red_coin"</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"green_coin"</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">-</span><span class="number">4</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"green_won_coin"</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">default</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"no_coin"</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="cbracket">}</span><span class="symbol">)()</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="symbol">/&gt;</span>
<span class="normal">        </span><span class="symbol">&lt;/</span><span class="normal">td</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="symbol">);</span>
<span class="cbracket">}</span><span class="symbol">;</span>
</tt></pre>
</div>

<p>Notice that JSX expects expressions in the JS bodies - and since <code>switch</code> is
a statement in TypeScript, I had to enclose it in an anonymous function and 
immediately call it.</p>

<h2>Was it worth it, in the end?</h2>

<p>Let me start by saying that the code that renders the board is now something like 40%
of the corresponding Canvas code.
<p>
But that's just the cherry on top - what really matters, is that inside that
<code>handleClick</code> member of my class, I just update the state...</p>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">var</span><span class="normal"> newBoard </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">this</span><span class="symbol">.</span><span class="function">dropDisk</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">.</span><span class="normal">state</span><span class="symbol">.</span><span class="normal">board</span><span class="symbol">,</span><span class="normal"> column</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">);</span>
<span class="symbol">...</span>
<span class="keyword">this</span><span class="symbol">.</span><span class="function">setState</span><span class="symbol">(</span><span class="cbracket">{</span>
<span class="normal">    board</span><span class="symbol">:</span><span class="normal"> newBoard</span><span class="symbol">,</span>
<span class="normal">    info</span><span class="symbol">:</span><span class="normal"> msg</span><span class="symbol">,</span>
<span class="normal">    wins</span><span class="symbol">:</span><span class="normal"> newWins</span><span class="symbol">,</span>
<span class="normal">    losses</span><span class="symbol">:</span><span class="normal"> newLosses</span><span class="symbol">,</span>
<span class="cbracket">}</span><span class="symbol">);</span>
</tt></pre>
</div>

<p>That's all there is to it - React will automatically figure out what changed
since last time, and will update the page to reflect the changes.
<p>
<b>Wow</b>. "Oh my God" kind of wow.</p>

<h2>Conclusion</h2>

<p>Well, frontend development has certainly changed a lot since the age of jQuery...
Even though I only ported a simple game, with a UI layer of 200 lines of code,
the difference in the mechanics used is very impressive. I can only imagine
what React's impact will be in major UIs with complex state - and how many
errors TypeScript will shield you from.
<p>
For example, to create the React component, I had to explicitely pass the
type of my state (<code>Score4State</code>)...</p>

<div class='codegenWrapper'>
<pre><tt><span class="keyword">class</span><span class="normal"> Score4 </span><span class="keyword">extends</span><span class="normal"> React</span><span class="symbol">.</span><span class="normal">Component</span><span class="symbol">&lt;</span><span class="normal">any</span><span class="symbol">,</span><span class="normal"> Score4State</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    brain</span><span class="symbol">:</span><span class="normal"> Score4_AI</span><span class="symbol">;</span>
<span class="normal">    </span><span class="symbol">...</span>
</tt></pre>
</div>

<p>...and <code>tsc</code> (the TypeScript compiler) guided me when I misused
my <code>this.state.&lt;fieldname&gt;</code> accesses.
<p>
Overall, I am very pleased to see how all these technologies have evolved.
And if I ever get back into frontend coding again, I will definitely make
use of them.
<p>
<p>Now go play Score4, <a href="#playnow">above</a> :-)
<br>
<br>
    <hr>
    <div style='margin-top:1em'>
        <div style='float:left'>
            <a target="_blank" href="https://stackoverflow.com/users/382050/ttsiodras">
                <img src="382050.png" width="208" height="58" alt="profile for ttsiodras at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for ttsiodras at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
            </a>
        </div>
        <div style='float:left; margin-left:1em'>
            <a target="_blank" href="https://github.com/ttsiodras">
                <img border="1" src="github.png" alt='GitHub member ttsiodras' title='GitHub member ttsiodras'>
            </a>
        </div>
        <!--div style='float:left; margin-left:1em'>
            <a target="_blank" href="https://projecteuler.net/profile/ttsiodras.png">
                <img src="https://projecteuler.net/profile/ttsiodras.png" alt='Project Euler member ttsiodras' title='Project Euler member ttsiodras'>
            </a>
        </div-->
    </div>
    <div style='clear:both; margin-bottom:0.5em'></div>

<!-- Used to do this with float:right, but Opera Mini shows nothing with it... back to tables :-( -->
<table summary="Footer" width="100%" border="0"><tr><td>&nbsp;<br><a href="index.html">Index</a><br>&nbsp;</td><td>&nbsp;<br><a href="cv.pdf">CV</a><br>&nbsp;</td><td align="right">&nbsp;<br><em>Updated: Sat Oct 8 11:41:25 2022</em><br>&nbsp;</td></tr></table>

            <hr style="margin-bottom: 1em">
            <p id="disqus_thread">
                The comments on this website require the use of JavaScript. Perhaps your browser isn't
                JavaScript capable; or the script is not being run for another reason. If you're
                interested in reading the comments or leaving a comment behind please try again with a
                different browser or from a different connection.
            </p>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'ttsiodras';
                var disqus_identifier = '../content/score4jsreact.content';

                (function() {
                    'use strict';

                    /**
                     * This method will handle the click on the button to load the comments. It will remove the
                     * button and execute the original Disqus script for loading the comments.
                     */
                    function button_clickHandler(event) {
                        // We need to get the button element, we could also use the target property of the event
                        // but this will do just as well
                        var button = document.getElementById('disqus_thread');
                        // Now we will have to recreate the div element we removed from the HTML. We will place
                        // it into the DOM like we did when we created the button
                        var disqusContainer = document.createElement('div');
                        button.parentNode.insertBefore(disqusContainer, button);
                        button.parentNode.removeChild(button);

                        // The div element will need to have the disqus_thread id as this is required for Disqus,
                        // it is the way their code identifies the element in which the comments can be displayed
                        disqusContainer.id = 'disqus_thread';

                        // Now we can execute the original Disqus code
                        var dsq = document.createElement('script');
                        dsq.type = 'text/javascript';
                        dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    }

                    /**
                     * This method will initialize the module. It will replace the JavaScript dependency message
                     * with a button which will allow the visitor to load the comments.
                     */
                    function init() {
                        // Try to get the element we used to display the message about the JavaScript dependency
                        var placeholder = document.getElementById('disqus_thread');
                        // If we didn't get the placeholder element we will stop setting up the button to load
                        // the comments
                        if (placeholder == null) {
                            return;
                        }

                        // The placeholder was found, now we can create the button which will allow the visitor to
                        // load the comments
                        var button = document.createElement('button');
                        button.appendChild(document.createTextNode('Click here to see the comments (powered by Disqus)'));
                        button.addEventListener('click', button_clickHandler.bind(this));

                        // We will insert the button before the placeholder and once the button has been placed in
                        // the DOM we will remove the placeholder
                        placeholder.parentNode.insertBefore(button, placeholder);
                        placeholder.parentNode.removeChild(placeholder);

                        // The placeholder used to have the id which can be reference by an anchor element, to make
                        // sure we don't break this functionality we will apply the id to our newly created button
                        button.id = 'disqus_thread';
                    }

                    // Setup the module
                    init();
                })();
            </script>
        </div>
    </div>
</body>
</html>
